flowchart TB

    %% 入口：审核通过后落审核记录
    E0["VideoAuditTraceRecordedDomainEvent"]
    class E0 domainevent;

    %% 生成密钥
    C1["GenerateHlsKeyCmd"]
    class C1 command;
    E1["VideoHlsKeyGeneratedDomainEvent"]
    class E1 domainevent;

    %% 加密转码
    S1["VideoHlsKeyGeneratedDomainEventSubscriber"]
    class S1 domaineventhandler;
    C2["TranscodeVideoToEncryptedHlsCmd"]
    class C2 command;
    E2["VideoEncryptedHlsGeneratedDomainEvent"]
    class E2 domainevent;

    %% Relationships
    E0 --> C1
    C1 --> E1
    E1 -->|on| S1
    S1 --> C2
    C2 --> E2

    %% Styles
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,font-weight:bold;
    classDef domainevent fill:#fff3e0,stroke:#e65100,stroke-width:2px,font-style:italic;
    classDef domaineventhandler fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,font-weight:bold;
