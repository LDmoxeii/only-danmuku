flowchart TB

    %% 命令入口：先落审核记录
    C0["CompatibleAdminVideoController.audit"]
    class C0 controllermethod;

    CMD1["RecordVideoAuditTraceCmd (FAILED)"]
    class CMD1 command;
    E1["VideoAuditTraceRecordedDomainEvent"]
    class E1 domainevent;

    %% 订阅事件后驱动稿件状态变更
    S1["VideoAuditTraceRecordedDomainEventSubscriber"]
    class S1 domaineventhandler;
    CMD2["AuditVideoPostCmd (status=REVIEW_FAILED)"]
    class CMD2 command;
    A1["VideoPost.audit / reviewFail"]
    class A1 entitymethod;
    E2["VideoAuditFailedDomainEvent"]
    class E2 domainevent;

    %% Relationships
    C0 --> CMD1
    CMD1 --> E1
    E1 -->|on| S1
    S1 --> CMD2
    CMD2 --> A1
    A1 --> E2

    %% Styles
    classDef controller fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-weight:bold;
    classDef controllermethod fill:#e3f2fd,stroke:#1976d2,stroke-width:2px;
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,font-weight:bold;
    classDef entitymethod fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef domainevent fill:#fff3e0,stroke:#e65100,stroke-width:2px,font-style:italic;
    classDef domaineventhandler fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,font-weight:bold;
