sequenceDiagram
  autonumber
  actor Admin as Admin
  participant Ctrl as CompatibleAdminVideoController
  participant RecordCmd as RecordVideoAuditTraceCmd
  participant Trace as VideoAuditTrace
  participant TraceSub as VideoAuditTraceRecordedDomainEventSubscriber
  participant AuditCmd as AuditVideoPostCmd
  participant Post as VideoPost
  participant MsgCmd as SendVideoAuditPassedMessageCmd
  participant PassSub as VideoAuditPassedDomainEventSubscriber
  participant RewardCmd as RewardUserForVideoCmd
  participant TransferCmd as TransferVideoToProductionCmd
  participant Video as Video
  participant TempQry as GetUploadedTempPathsQry
  participant CleanCli as CleanTempFilesCli

  Admin->>Ctrl: POST /admin/videoInfo/auditVideo(videoId, status=REVIEW_PASSED)
  Ctrl->>RecordCmd: RecordVideoAuditTraceCmd.Request(videoPostId, auditStatus=PASSED, reviewer...)
  RecordCmd->>Trace: Mediator.factories.create(VideoAuditTraceFactory.Payload)
  Note over Trace: onCreate auto-triggered by Mediator.factories.create
  Trace-->>RecordCmd: VideoAuditTraceRecordedDomainEvent
  RecordCmd->>RecordCmd: UoW save

  Trace-->>TraceSub: VideoAuditTraceRecordedDomainEvent
  TraceSub->>AuditCmd: AuditVideoPostCmd.Request(status=REVIEW_PASSED, reason)
  TraceSub->>MsgCmd: SendVideoAuditPassedMessageCmd.Request(videoId, operatorId)

  AuditCmd->>Post: reviewPass() -> VideoAuditPassedDomainEvent
  AuditCmd->>AuditCmd: UoW save
  Post-->>PassSub: VideoAuditPassedDomainEvent

  Note over PassSub: three listeners (reward, transfer, cleanup)
  PassSub->>RewardCmd: RewardUserForVideoCmd.Request(customerId)
  PassSub->>TransferCmd: TransferVideoToProductionCmd.Request(...)
  TransferCmd->>TransferCmd: load VideoFilePosts + find existing Video
  alt video exists
    TransferCmd->>Video: syncFromBasics(...)
  else new video
    TransferCmd->>Video: Mediator.factories.create(VideoFactory.Payload)
    Note over Video: onCreate auto-triggered by Mediator.factories.create
  end
  TransferCmd->>TransferCmd: UoW save
  PassSub->>TempQry: GetUploadedTempPathsQry(customerId, videoId)
  TempQry-->>PassSub: tempPaths
  PassSub->>CleanCli: CleanTempFilesCli.Request(tempPaths)
