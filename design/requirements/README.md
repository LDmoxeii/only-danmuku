# DDD äº‹ä»¶é©±åŠ¨éœ€æ±‚æ–‡æ¡£ç¼–å†™æŒ‡å—

> ä» easylive-java ä¼ ç»Ÿä¸‰å±‚æ¶æ„éœ€æ±‚åˆ° DDD äº‹ä»¶é©±åŠ¨æ¨¡å¼è®¾è®¡çš„å®Œæ•´æµç¨‹

## ğŸ“Œ æ–‡æ¡£ç¼–å†™æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæ·±åº¦åˆ†æ easylive-java å·²æœ‰éœ€æ±‚å®ç°

#### 1.1 ä»è¯·æ±‚å…¥å£å¼€å§‹åˆ†æ

**åˆ†æè·¯å¾„**ï¼š`Controller â†’ Service â†’ Mapper â†’ AOPåˆ‡é¢`

**å…³æ³¨è¦ç‚¹**ï¼š
- âœ… **Controller å±‚**
  - è¯·æ±‚è·¯å¾„å’Œ HTTP æ–¹æ³•
  - è¯·æ±‚å‚æ•°ï¼ˆå¿…å¡«/å¯é€‰ã€éªŒè¯æ³¨è§£ï¼‰
  - å“åº”ç»“æ„
  - å¼‚å¸¸å¤„ç†

- âœ… **Service å±‚**
  - ä¸šåŠ¡é€»è¾‘æµç¨‹
  - æ•°æ®æ ¡éªŒè§„åˆ™ï¼ˆé‚®ç®±å”¯ä¸€æ€§ã€æ˜µç§°å”¯ä¸€æ€§ç­‰ï¼‰
  - å¤–éƒ¨ä¾èµ–è°ƒç”¨ï¼ˆRedisã€å…¶ä»– Serviceï¼‰
  - äº‹åŠ¡è¾¹ç•Œï¼ˆ`@Transactional`ï¼‰

- âœ… **Mapper å±‚**
  - æ•°æ®åº“è¡¨ç»“æ„
  - èšåˆæ ¹è¾¹ç•Œè¯†åˆ«
  - å…³è”æŸ¥è¯¢åˆ†æ

- âœ… **AOP åˆ‡é¢**
  - å…¨å±€æ‹¦æˆªå™¨ï¼ˆå¦‚ `@GlobalInterceptor`ï¼‰
  - æƒé™æ ¡éªŒ
  - æ—¥å¿—è®°å½•

**åˆ†æå·¥å…·**ï¼š
```bash
# æœç´¢ç›¸å…³æ–‡ä»¶
find easylive-java -name "*Controller.java"
find easylive-java -name "*Service*.java"

# æŸ¥çœ‹å…·ä½“å®ç°
cat easylive-java/.../AccountController.java
cat easylive-java/.../UserInfoServiceImpl.java
```

---

### ç¬¬äºŒæ­¥ï¼šåˆ†æ only-danmuku design ä¸­å·²æœ‰çš„å‘½ä»¤/äº‹ä»¶è®¾è®¡

#### 2.1 æ£€æŸ¥èšåˆè®¾è®¡æ–‡ä»¶

**æ£€æŸ¥è·¯å¾„**ï¼š
```
design/aggregate/
â”œâ”€â”€ user/_gen.json                    # User èšåˆçš„å‘½ä»¤/äº‹ä»¶/æŸ¥è¯¢
â”œâ”€â”€ customer_profile/_gen.json        # CustomerProfile èšåˆ
â”œâ”€â”€ video/_gen.json                   # Video èšåˆ
â””â”€â”€ ... (å…¶ä»–èšåˆ)
```

**æ£€æŸ¥å†…å®¹**ï¼š
- âœ… å·²å®šä¹‰çš„å‘½ä»¤ (`cmd` èŠ‚ç‚¹)
- âœ… å·²å®šä¹‰çš„é¢†åŸŸäº‹ä»¶ (`de` èŠ‚ç‚¹)
- âœ… å·²å®šä¹‰çš„æŸ¥è¯¢ (`qry` èŠ‚ç‚¹)

**ç¤ºä¾‹å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹ User èšåˆè®¾è®¡
cat design/aggregate/user/_gen.json | jq '.cmd'
cat design/aggregate/user/_gen.json | jq '.de'
cat design/aggregate/user/_gen.json | jq '.qry'
```

#### 2.2 æ£€æŸ¥ extra æ‰©å±•è®¾è®¡

**æ£€æŸ¥è·¯å¾„**ï¼š
```
design/extra/
â”œâ”€â”€ account_user_count_gen.json       # é¢å¤–æŸ¥è¯¢
â”œâ”€â”€ admin_interact_gen.json
â””â”€â”€ ... (å…¶ä»–æ‰©å±•)
```

---

### ç¬¬ä¸‰æ­¥ï¼šå°†ä¼ ç»Ÿä¸‰å±‚æ¶æ„è§£æä¸º DDD äº‹ä»¶é©±åŠ¨æ¨¡å¼

#### 3.1 è¯†åˆ«èšåˆæ ¹å’Œèšåˆè¾¹ç•Œ

| ä¼ ç»Ÿå®ä½“ | DDD èšåˆæ ¹ | èŒè´£è¾¹ç•Œ |
|---------|-----------|---------|
| `UserInfo` | `User` + `CustomerProfile` | User: è®¤è¯ä¿¡æ¯<br>CustomerProfile: æ¡£æ¡ˆå’Œç»Ÿè®¡ |
| `VideoInfo` | `Video` + `VideoFile` | Video: å…ƒæ•°æ®<br>VideoFile: æ–‡ä»¶ä¿¡æ¯ |
| `VideoComment` | `VideoComment` | è¯„è®ºèšåˆæ ¹ |

#### 3.2 æå–ä¸šåŠ¡æµç¨‹ä¸­çš„å‘½ä»¤

**è§„åˆ™**ï¼š
- å†™æ“ä½œ â†’ å‘½ä»¤ (Command)
- è¯»æ“ä½œ â†’ æŸ¥è¯¢ (Query)

**ç¤ºä¾‹**ï¼š
```java
// Service å±‚ä»£ç 
userInfoService.register(email, nickName, password);
```
â†“ è½¬æ¢ä¸º
```kotlin
// DDD å‘½ä»¤
Mediator.commands.send(
    RegisterAccountCmd.Request(email, nickName, password)
)
```

#### 3.3 è¯†åˆ«é¢†åŸŸäº‹ä»¶

**è¯†åˆ«æ—¶æœº**ï¼š
- èšåˆæ ¹çŠ¶æ€å‘ç”Ÿé‡è¦å˜åŒ–æ—¶
- éœ€è¦è§¦å‘åç»­ä¸šåŠ¡æµç¨‹æ—¶
- éœ€è¦è®°å½•å®¡è®¡æ—¥å¿—æ—¶

**ç¤ºä¾‹**ï¼š
```java
// ä¼ ç»Ÿä»£ç ï¼šç›´æ¥åœ¨ Service ä¸­åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆ
userInfo = new UserInfo();
userInfo.setTotalCoinCount(10);
userInfoMapper.insert(userInfo);
```
â†“ è½¬æ¢ä¸º
```kotlin
// DDD äº‹ä»¶é©±åŠ¨
User.onCreate() â†’ å‘å¸ƒ UserCreatedDomainEvent
  â†’ UserCreatedDomainEventHandler ç›‘å¬
    â†’ å‘é€ CreateCustomerProfileCmd
      â†’ åˆ›å»º CustomerProfile èšåˆæ ¹
```

#### 3.4 ç»˜åˆ¶äº‹ä»¶æµå›¾

**æ ¼å¼è¦æ±‚**ï¼š
1. **ASCII æµç¨‹å›¾**ï¼ˆç”¨äºæ–‡æœ¬æŸ¥çœ‹ï¼‰
2. **Mermaid æµç¨‹å›¾**ï¼ˆç”¨äºæ¸²æŸ“å¯è§†åŒ–ï¼‰

---

### ç¬¬å››æ­¥ï¼šæ•´ç†å®Œæ•´æµç¨‹æ–‡æ¡£

#### 4.1 æ–‡æ¡£ç»“æ„æ¨¡æ¿ï¼ˆç²¾ç®€ç‰ˆï¼‰

```markdown
# {åŠŸèƒ½åç§°}æµç¨‹è®¾è®¡æ–‡æ¡£

> åŸºäº easylive-java é¡¹ç›®éœ€æ±‚ï¼ŒæŒ‰ç…§ DDD äº‹ä»¶é©±åŠ¨æ¨¡å¼è®¾è®¡

## ğŸ“‹ ä¸šåŠ¡éœ€æ±‚æ¦‚è¿°
{1-2 å¥è¯ç®€è¦æè¿°ä¸šåŠ¡åœºæ™¯}

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

### ASCII æµç¨‹å›¾
\```
{ASCII æ ¼å¼çš„æµç¨‹å›¾}
\```

### Mermaid æµç¨‹å›¾
\```mermaid
{Mermaid ä»£ç }
\```

**å›¾ä¾‹è¯´æ˜**ï¼š
- ğŸ”µ è“è‰²ï¼šè¯·æ±‚å…¥å£
- ğŸŸ¢ ç»¿è‰²ï¼šå·²å­˜åœ¨çš„è®¾è®¡ï¼ˆâœ… å¯ç›´æ¥ä½¿ç”¨ï¼‰
- ğŸ”´ çº¢è‰²ï¼šç¼ºå¤±çš„è®¾è®¡ï¼ˆâŒ éœ€å®ç°ï¼‰
- ğŸŸ¡ é»„è‰²ï¼šå¯é€‰æ‰©å±•ï¼ˆâšªï¼‰

---

## ğŸ“¦ è®¾è®¡å…ƒç´ æ¸…å•

### âœ… å·²å­˜åœ¨çš„è®¾è®¡

#### å‘½ä»¤ (Commands)
| å‘½ä»¤ | æè¿° | çŠ¶æ€ | ä½ç½® |
|------|------|------|------|
| ... | ... | âœ… | `design/aggregate/.../` |

#### é¢†åŸŸäº‹ä»¶ (Domain Events)
| äº‹ä»¶ | æè¿° | è§¦å‘æ—¶æœº | çŠ¶æ€ | ä½ç½® |
|------|------|----------|------|------|
| ... | ... | ... | âœ… | `design/aggregate/.../` |

#### æŸ¥è¯¢ (Queries)
| æŸ¥è¯¢ | æè¿° | çŠ¶æ€ | ä½ç½® |
|------|------|------|------|
| ... | ... | âœ… | `design/aggregate/.../` |

---

### âŒ ç¼ºå¤±çš„è®¾è®¡æ¸…å•

#### éœ€è¦è¡¥å……çš„å‘½ä»¤
| åºå· | å‘½ä»¤åç§° | æè¿° | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|----------|-------|
| 1 | ... | ... | `design/extra/xxx_gen.json` | P0 |

#### éœ€è¦è¡¥å……çš„é¢†åŸŸäº‹ä»¶
| åºå· | äº‹ä»¶åç§° | æè¿° | è§¦å‘æ—¶æœº | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|----------|----------|-------|
| 1 | ... | ... | ... | `design/extra/xxx_gen.json` | P0 |

#### éœ€è¦è¡¥å……çš„æŸ¥è¯¢
| åºå· | æŸ¥è¯¢åç§° | æè¿° | è¿”å›å€¼ | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|--------|----------|-------|
| 1 | ... | ... | ... | `design/extra/xxx_gen.json` | P0 |

#### éœ€è¦è¡¥å……çš„éªŒè¯å™¨
| åºå· | éªŒè¯å™¨åç§° | æè¿° | ä¾èµ–æŸ¥è¯¢ | å®ç°è·¯å¾„ | ä¼˜å…ˆçº§ |
|-----|-----------|------|----------|----------|-------|
| 1 | ... | ... | ... | `application/.../validater/` | P0 |

#### éœ€è¦è¡¥å……çš„äº‹ä»¶å¤„ç†å™¨
| åºå· | å¤„ç†å™¨åç§° | ç›‘å¬äº‹ä»¶ | è§¦å‘å‘½ä»¤ | å®ç°è·¯å¾„ | ä¼˜å…ˆçº§ |
|-----|-----------|----------|----------|----------|-------|
| 1 | ... | ... | ... | `adapter/.../events/` | P0 |

**ä¼˜å…ˆçº§è¯´æ˜**ï¼š
- **P0**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»å®ç°
- **P1**ï¼šé‡è¦åŠŸèƒ½ï¼Œå»ºè®®å®ç°
- **P2**ï¼šå¯é€‰åŠŸèƒ½ï¼Œåç»­æ‰©å±•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¶é—´**ï¼š{æ—¥æœŸ}
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ
```

**è¯´æ˜**ï¼š
- âœ… **ä¿ç•™**ï¼šä¸šåŠ¡æ¦‚è¿°ã€å®Œæ•´æµç¨‹å›¾ï¼ˆä¸¤ç§æ ¼å¼ï¼‰ã€è®¾è®¡å…ƒç´ æ¸…å•ã€ç¼ºå¤±è®¾è®¡æ¸…å•
- âŒ **ç§»é™¤**ï¼šå®ç°æ­¥éª¤ã€æµ‹è¯•ç”¨ä¾‹ã€éªŒæ”¶æ ‡å‡†ï¼ˆå‡å°‘å·¥ä½œé‡å’Œ token ä½¿ç”¨ï¼‰
- ğŸ“ **é‡ç‚¹**ï¼šå®Œæ•´æµç¨‹å›¾ + ç¼ºå¤±è®¾è®¡æ¸…å•

#### 4.2 å®Œæ•´æµç¨‹å›¾æ ¼å¼

##### æ ¼å¼ 1ï¼šASCII æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯·æ±‚ï¼šPOST /account/register                     â”‚
â”‚ Payload: { email, nickName, password }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘½ä»¤ï¼šRegisterAccountCmd âœ…                      â”‚
â”‚ â”œâ”€ éªŒè¯å™¨ï¼š@UniqueUserEmail âœ…                   ï¿½ï¿½ï¿½
â”‚ â”œâ”€ éªŒè¯å™¨ï¼š@UniqueNickname âŒ                    â”‚
â”‚ â””â”€ UserFactory.create()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢†åŸŸäº‹ä»¶ï¼šUserCreatedDomainEvent âœ…              â”‚
â”‚ { userId, email, nickName }                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶å¤„ç†å™¨ #1    â”‚    â”‚ äº‹ä»¶å¤„ç†å™¨ #2    â”‚
â”‚ åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆ      â”‚    â”‚ å‘é€æ¬¢è¿é‚®ä»¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘½ä»¤ï¼šCreateCustomerProfileCmd âœ…                â”‚
â”‚ â”œâ”€ æŸ¥è¯¢ç³»ç»Ÿè®¾ç½® GetSystemSettingQry âŒ           â”‚
â”‚ â””â”€ CustomerProfileFactory.create()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢†åŸŸäº‹ä»¶ï¼šCustomerProfileCreatedDomainEvent âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### æ ¼å¼ 2ï¼šMermaid æµç¨‹å›¾

```mermaid
graph TD
    A[è¯·æ±‚: POST /account/register] --> B[å‘½ä»¤: RegisterAccountCmd âœ…]
    B --> B1[éªŒè¯å™¨: @UniqueUserEmail âœ…]
    B --> B2[éªŒè¯å™¨: @UniqueNickname âŒ]
    B --> B3[UserFactory.create]

    B3 --> C[é¢†åŸŸäº‹ä»¶: UserCreatedDomainEvent âœ…]

    C --> D1[äº‹ä»¶å¤„ç†å™¨ #1: åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆ âŒ]
    C --> D2[äº‹ä»¶å¤„ç†å™¨ #2: å‘é€æ¬¢è¿é‚®ä»¶ âšª]

    D1 --> E[å‘½ä»¤: CreateCustomerProfileCmd âœ…]
    E --> E1[æŸ¥è¯¢: GetSystemSettingQry âŒ]
    E --> E2[CustomerProfileFactory.create]

    E2 --> F[é¢†åŸŸäº‹ä»¶: CustomerProfileCreatedDomainEvent âœ…]

    style B fill:#90EE90
    style C fill:#90EE90
    style E fill:#90EE90
    style F fill:#90EE90
    style B2 fill:#FFB6C1
    style D1 fill:#FFB6C1
    style E1 fill:#FFB6C1
    style D2 fill:#F0E68C

    classDef existing fill:#90EE90,stroke:#333,stroke-width:2px
    classDef missing fill:#FFB6C1,stroke:#333,stroke-width:2px
    classDef optional fill:#F0E68C,stroke:#333,stroke-width:2px
```

**å›¾ä¾‹è¯´æ˜**ï¼š
- ğŸŸ¢ ç»¿è‰²ï¼šå·²å­˜åœ¨çš„è®¾è®¡ï¼ˆâœ…ï¼‰
- ğŸ”´ ç²‰è‰²ï¼šç¼ºå¤±çš„è®¾è®¡ï¼ˆâŒï¼‰
- ğŸŸ¡ é»„è‰²ï¼šå¯é€‰æ‰©å±•ï¼ˆâšªï¼‰

---

#### 4.3 ç¼ºå¤±è®¾è®¡è¡¥å……æ¸…å•æ¨¡æ¿

```markdown
## âŒ ç¼ºå¤±çš„è®¾è®¡æ¸…å•

### éœ€è¦è¡¥å……çš„å‘½ä»¤ (Commands)

| åºå· | å‘½ä»¤åç§° | æè¿° | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|----------|-------|
| 1   | `XxxCmd` | æè¿° | `design/extra/xxx_gen.json` | P0 |

### éœ€è¦è¡¥å……çš„é¢†åŸŸäº‹ä»¶ (Domain Events)

| åºå· | äº‹ä»¶åç§° | æè¿° | è§¦å‘æ—¶æœº | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|----------|----------|-------|
| 1   | `XxxDomainEvent` | æè¿° | æ—¶æœº | `design/extra/xxx_gen.json` | P0 |

### éœ€è¦è¡¥å……çš„æŸ¥è¯¢ (Queries)

| åºå· | æŸ¥è¯¢åç§° | æè¿° | è¿”å›å€¼ | å»ºè®®ä½ç½® | ä¼˜å…ˆçº§ |
|-----|---------|------|--------|----------|-------|
| 1   | `GetXxxQry` | æè¿° | ç±»å‹ | `design/extra/xxx_gen.json` | P0 |

### éœ€è¦è¡¥å……çš„éªŒè¯å™¨ (Validators)

| åºå· | éªŒè¯å™¨åç§° | æè¿° | ä¾èµ–æŸ¥è¯¢ | å®ç°è·¯å¾„ | ä¼˜å…ˆçº§ |
|-----|-----------|------|----------|----------|-------|
| 1   | `@XxxValidator` | æè¿° | `XxxQry` | `application/.../validater/` | P0 |

### éœ€è¦è¡¥å……çš„äº‹ä»¶å¤„ç†å™¨ (Event Handlers)

| åºå· | å¤„ç†å™¨åç§° | ç›‘å¬äº‹ä»¶ | è§¦å‘å‘½ä»¤ | å®ç°è·¯å¾„ | ä¼˜å…ˆçº§ |
|-----|-----------|----------|----------|----------|-------|
| 1   | `XxxEventHandler` | `XxxEvent` | `XxxCmd` | `adapter/.../events/` | P0 |

### ä¼˜å…ˆçº§è¯´æ˜
- **P0**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»å®ç°
- **P1**ï¼šé‡è¦åŠŸèƒ½ï¼Œå»ºè®®å®ç°
- **P2**ï¼šå¯é€‰åŠŸèƒ½ï¼Œåç»­æ‰©å±•
```

---

## ğŸ“ æ–‡æ¡£è¾“å‡ºè§„èŒƒ

### æ–‡ä»¶å‘½åè§„èŒƒ

```
design/requirements/
â”œâ”€â”€ {åŠŸèƒ½æ¨¡å—}_{æ“ä½œ}_flow.md        # ä¸»æµç¨‹æ–‡æ¡£
â”œâ”€â”€ {åŠŸèƒ½æ¨¡å—}_{æ“ä½œ}_missing.json   # ç¼ºå¤±è®¾è®¡çš„ JSON å®šä¹‰ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ README.md                         # æœ¬æŒ‡å—æ–‡æ¡£
```

**ç¤ºä¾‹**ï¼š
```
design/requirements/
â”œâ”€â”€ user_register_flow.md             # ç”¨æˆ·ï¿½ï¿½ï¿½å†Œæµç¨‹
â”œâ”€â”€ user_login_flow.md                # ç”¨æˆ·ç™»å½•æµç¨‹
â”œâ”€â”€ video_upload_flow.md              # è§†é¢‘ä¸Šä¼ æµç¨‹
â””â”€â”€ README.md
```

---

## ğŸ”§ å·¥å…·å’Œå‘½ä»¤

### åˆ†æ easylive-java é¡¹ç›®

```bash
# 1. æœç´¢æ§åˆ¶å™¨
find easylive-java -name "*Controller.java" | grep -v test

# 2. æœç´¢æœåŠ¡å®ç°
find easylive-java -name "*ServiceImpl.java"

# 3. æœç´¢ç‰¹å®šåŠŸèƒ½
grep -r "register" easylive-java/easylive-web/src/main/java

# 4. æŸ¥çœ‹æ•°æ®åº“è¡¨ç»“æ„
cat easylive-java/.../UserInfo.java
```

### åˆ†æ only-danmuku design

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰èšåˆ
ls design/aggregate/

# 2. æŸ¥çœ‹ç‰¹å®šèšåˆçš„è®¾è®¡
cat design/aggregate/user/_gen.json | jq '.'

# 3. æå–æ‰€æœ‰å‘½ä»¤
cat design/aggregate/user/_gen.json | jq '.cmd[].name'

# 4. æå–æ‰€æœ‰äº‹ä»¶
cat design/aggregate/user/_gen.json | jq '.de[].name'

# 5. æå–æ‰€æœ‰æŸ¥è¯¢
cat design/aggregate/user/_gen.json | jq '.qry[].name'
```

### ç”Ÿæˆä»£ç 

```bash
# 1. è¿è¡Œä»£ç ç”Ÿæˆ
./gradlew codegen

# 2. ç”Ÿæˆ Jimmer DTO
./gradlew :only-danmuku-application:kspKotlin

# 3. å®Œæ•´æ„å»º
./gradlew build
```

---

## âœ… æ£€æŸ¥æ¸…å•

### éœ€æ±‚åˆ†æé˜¶æ®µ
- [ ] Controller å±‚çš„è¯·æ±‚ï¿½ï¿½å¾„å’Œå‚æ•°å·²åˆ†æ
- [ ] Service å±‚çš„ä¸šåŠ¡é€»è¾‘å·²æ¢³ç†
- [ ] Mapper å±‚çš„æ•°æ®åº“è¡¨ç»“æ„å·²ç†è§£
- [ ] AOP åˆ‡é¢çš„æ‹¦æˆªé€»è¾‘å·²äº†è§£

### è®¾è®¡æ˜ å°„é˜¶æ®µ
- [ ] å·²æ£€æŸ¥ design/aggregate/ ä¸­çš„ç›¸å…³èšåˆ
- [ ] å·²æ£€æŸ¥ design/extra/ ä¸­çš„æ‰©å±•å®šä¹‰
- [ ] å·²è¯†åˆ«ç¼ºå¤±çš„å‘½ä»¤ã€äº‹ä»¶ã€æŸ¥è¯¢
- [ ] å·²å®Œæˆä¼ ç»Ÿæ¶æ„åˆ° DDD çš„æ˜ å°„

### æ–‡æ¡£ç¼–å†™é˜¶æ®µ
- [ ] ä¸šåŠ¡éœ€æ±‚æ¦‚è¿°å·²ç¼–å†™
- [ ] ASCII æµç¨‹å›¾å·²ç»˜åˆ¶
- [ ] Mermaid æµç¨‹å›¾å·²ç¼–å†™
- [ ] è®¾è®¡å…ƒç´ æ¸…å•å·²æ•´ç†
- [ ] ç¼ºå¤±è®¾è®¡æ¸…å•å·²åˆ—å‡ºï¼ˆé‡ç‚¹ï¼‰
- [ ] å®ç°æ­¥éª¤å·²ç¼–å†™
- [ ] æµ‹è¯•ç”¨ä¾‹å·²æä¾›
- [ ] éªŒæ”¶æ ‡å‡†å·²å®šä¹‰

### æ–‡æ¡£è´¨é‡æ£€æŸ¥
- [ ] ä¸šåŠ¡éœ€æ±‚æ¦‚è¿°å·²ç¼–å†™ï¼ˆ1-2 å¥è¯ï¼‰
- [ ] ASCII æµç¨‹å›¾å·²ç»˜åˆ¶ï¼ˆé‡ç‚¹ï¼‰
- [ ] Mermaid æµç¨‹å›¾å·²ç¼–å†™ï¼ˆé‡ç‚¹ï¼‰
- [ ] å·²å­˜åœ¨è®¾è®¡æ¸…å•å·²æ•´ç†
- [ ] ç¼ºå¤±è®¾è®¡æ¸…å•å·²åˆ—å‡ºï¼ˆé‡ç‚¹ï¼‰
- [ ] ç¼ºå¤±è®¾è®¡æœ‰æ˜ç¡®ä¼˜å…ˆçº§ï¼ˆé‡ç‚¹ï¼‰
- [ ] çŠ¶æ€æ ‡è®°æ­£ç¡®ï¼ˆâœ… âŒ âšªï¼‰
- [ ] æ–‡ä»¶è·¯å¾„å¼•ç”¨å‡†ç¡®
- [ ] Markdown æ ¼å¼æ­£ç¡®

---

## ğŸ“š å‚è€ƒèµ„æ–™

### ğŸ“ æ¨¡æ¿æ–‡ä»¶
- [\_TEMPLATE.md](./_TEMPLATE.md) - ç²¾ç®€ç‰ˆéœ€æ±‚æ–‡æ¡£æ¨¡æ¿ï¼ˆå¤åˆ¶ä½¿ç”¨ï¼‰

### ğŸ“‹ å®Œæ•´ç¤ºä¾‹
- [user_register_flow.md](./user_register_flow.md) - ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ˆåŒ…å«å®Œæ•´çš„æµç¨‹å›¾å’Œç¼ºå¤±è®¾è®¡æ¸…å•ï¼‰

### ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å¤åˆ¶æ¨¡æ¿**
   ```bash
   cp design/requirements/_TEMPLATE.md design/requirements/{åŠŸèƒ½}_flow.md
   ```

2. **å¡«å……å†…å®¹**
   - ä¸šåŠ¡éœ€æ±‚æ¦‚è¿°ï¼ˆ1-2 å¥è¯ï¼‰
   - ASCII æµç¨‹å›¾
   - Mermaid æµç¨‹å›¾
   - å·²å­˜åœ¨è®¾è®¡æ¸…å•
   - ç¼ºå¤±è®¾è®¡æ¸…å•ï¼ˆé‡ç‚¹ï¼‰

3. **ç”Ÿæˆç¼ºå¤±è®¾è®¡**
   ```bash
   # åœ¨ design/extra/ æ–°å¢ JSON æ–‡ä»¶
   # è¿è¡Œä»£ç ç”Ÿæˆ
   ./gradlew codegen
   ```

---

## ğŸ¯ æ–‡æ¡£æ ¸å¿ƒä»·å€¼

æ ¹æ®éœ€æ±‚ï¼Œæ–‡æ¡£çš„**æ ¸å¿ƒä»·å€¼**æ˜¯ï¼š

### âœ… **1. å®Œæ•´æµç¨‹å›¾**ï¼ˆä¸¤ç§æ ¼å¼ï¼‰

- **ASCII æµç¨‹å›¾**ï¼šæ–‡æœ¬å‹å¥½ï¼Œé€‚åˆä»£ç å®¡æŸ¥å’Œæ–‡æ¡£æŸ¥çœ‹
- **Mermaid æµç¨‹å›¾**ï¼šå¯è§†åŒ–æ¸²æŸ“ï¼Œé€‚åˆå›¢é˜Ÿåˆ†äº«å’Œæ¼”ç¤º

### âœ… **2. ç¼ºå¤±è®¾è®¡æ¸…å•**

æ¸…æ™°åˆ—å‡ºéœ€è¦è¡¥å……çš„ï¼š
- å‘½ä»¤ (Commands)
- é¢†åŸŸäº‹ä»¶ (Domain Events)
- æŸ¥è¯¢ (Queries)
- éªŒè¯å™¨ (Validators)
- äº‹ä»¶å¤„ç†å™¨ (Event Handlers)

æ¯é¡¹éƒ½æœ‰**ä¼˜å…ˆçº§**å’Œ**å»ºè®®ä½ç½®**ï¼Œæ–¹ä¾¿åç»­å®ç°ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¶é—´**ï¼š2025-10-22
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ
