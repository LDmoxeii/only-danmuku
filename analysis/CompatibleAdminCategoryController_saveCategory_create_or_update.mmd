flowchart TB

    N1["CompatibleAdminCategoryController.addCategory"]
    class N1 controllermethod;

    %% Create branch
    M1["AdminCategorySave.Converter.toCreateCmd"]
    class M1 commandsender;
    C1["CreateCategoryCmd"]
    class C1 command;
    A1["Category.onCreate"]
    class A1 entitymethod;
    E1["CategoryCreatedDomainEvent"]
    class E1 domainevent;
    CC1["FinalizeCategoryAfterCreateCmd"]
    class CC1 command;
    A1b["Category.changeSort"]
    class A1b entitymethod;
    E1b["CategorySortChangedDomainEvent"]
    class E1b domainevent;
    A1c["Category.updateNodePath"]
    class A1c entitymethod;
    E1c["CategoryNodePathUpdatedDomainEvent"]
    class E1c domainevent;

    %% Update branch
    M2["AdminCategorySave.Converter.toUpdateCmd"]
    class M2 commandsender;
    C2["UpdateCategoryInfoCmd"]
    class C2 command;
    A2["Category.updateBasicInfo"]
    class A2 entitymethod;
    E2["CategoryBasicInfoUpdatedDomainEvent"]
    class E2 domainevent;
    A3["Category.changeParent"]
    class A3 entitymethod;
    E3["CategoryParentChangedDomainEvent"]
    class E3 domainevent;
    A4["Category.changeCode"]
    class A4 entitymethod;
    E4["CategoryCodeChangedDomainEvent"]
    class E4 domainevent;

    %% Relationships
    N1 -->|maps| M1
    M1 -->|sends| C1
    C1 -->|executes| A1
    A1 -->|publishes| E1
    E1 -->|sends| CC1
    CC1 -->|executes| A1b
    A1b -->|publishes| E1b
    CC1 -->|executes| A1c
    A1c -->|publishes| E1c

    N1 -->|maps| M2
    M2 -->|sends| C2
    C2 -->|executes| A2
    A2 -->|publishes| E2
    C2 -->|executes| A3
    A3 -->|publishes| E3
    C2 -->|executes| A4
    A4 -->|publishes| E4

    %% Styles
    classDef controller fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-weight:bold;
    classDef controllermethod fill:#e3f2fd,stroke:#1976d2,stroke-width:2px;
    classDef endpoint fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px;
    classDef commandsender fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-style:italic;
    classDef commandsendermethod fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,font-style:italic;
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,font-weight:bold;
    classDef commandhandler fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,font-weight:bold;
    classDef aggregate fill:#fff8e1,stroke:#ff8f00,stroke-width:3px,font-weight:bold;
    classDef entitymethod fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef domainevent fill:#fff3e0,stroke:#e65100,stroke-width:2px,font-style:italic;
    classDef domaineventhandler fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,font-weight:bold;
    classDef integrationevent fill:#fce4ec,stroke:#880e4f,stroke-width:2px;
    classDef integrationeventhandler fill:#fce4ec,stroke:#ad1457,stroke-width:2px,font-weight:bold;
    classDef integrationeventconverter fill:#e3f2fd,stroke:#0277bd,stroke-width:2px;
    classDef repo fill:#d6dbdf,stroke:#85929e,stroke-width:2px;
    classDef uow fill:#f2f4f4,stroke:#7f8c8d,stroke-width:2px;
