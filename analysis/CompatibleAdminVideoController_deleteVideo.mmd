flowchart TB

    N1["CompatibleAdminVideoController.deleteVideo"]
    class N1 controllermethod;

    C1["DeleteVideoPostCmd"]
    class C1 command;
    A1["VideoPost.onDelete"]
    class A1 entitymethod;
    E1["VideoPostDeletedDomainEvent"]
    class E1 domainevent;

    %% Event-driven follow-ups
    C2["DeleteVideoCmd"]
    class C2 command;
    C3["AdjustAuthorCoinAfterDeleteCmd"]
    class C3 command;

    A2["Video.onDelete (for each)"]
    class A2 entitymethod;
    E2["VideoDeletedDomainEvent"]
    class E2 domainevent;

    AP1["CustomerProfile.reclaimRewardCoins"]
    class AP1 entitymethod;
    EP1["CustomerProfileRewardCoinsReclaimedDomainEvent"]
    class EP1 domainevent;

    C5["BatchDeleteDanmukuCmd"]
    class C5 command;
    C6["BatchDeleteCommentCmd"]
    class C6 command;

    AD1["VideoDanmuku.onDelete (for each)"]
    class AD1 entitymethod;
    ED1["DanmukuDeletedDomainEvent"]
    class ED1 domainevent;

    AC1["VideoComment.onDelete (for each)"]
    class AC1 entitymethod;
    EC1["CommentDeletedDomainEvent"]
    class EC1 domainevent;

    C7["UpdateVideoStatisticsCmd"]
    class C7 command;
    AV1["Video.applyStatisticsDelta"]
    class AV1 entitymethod;
    EV1["VideoStatisticsDeltaAppliedDomainEvent"]
    class EV1 domainevent;

    %% Relationships
    N1 -->|sends| C1
    C1 -->|executes| A1
    A1 -->|publishes| E1

    %% From VideoPostDeletedDomainEvent
    E1 -->|sends| C2
    E1 -->|sends| C3

    C2 -->|executes| A2
    A2 -->|publishes| E2

    C3 -->|executes| AP1
    AP1 -->|publishes| EP1

    %% From VideoDeletedDomainEvent
    E2 -->|sends| C5
    E2 -->|sends| C6

    C5 -->|executes| AD1
    AD1 -->|publishes| ED1

    C6 -->|executes| AC1
    AC1 -->|publishes| EC1

    %% Update statistics after comment/danmuku deletion
    ED1 -->|sends| C7
    EC1 -->|sends| C7
    C7 -->|executes| AV1
    AV1 -->|publishes| EV1

    %% Styles
    classDef controller fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-weight:bold;
    classDef controllermethod fill:#e3f2fd,stroke:#1976d2,stroke-width:2px;
    classDef endpoint fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px;
    classDef commandsender fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,font-style:italic;
    classDef commandsendermethod fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,font-style:italic;
    classDef command fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,font-weight:bold;
    classDef commandhandler fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,font-weight:bold;
    classDef aggregate fill:#fff8e1,stroke:#ff8f00,stroke-width:3px,font-weight:bold;
    classDef entitymethod fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef domainevent fill:#fff3e0,stroke:#e65100,stroke-width:2px,font-style:italic;
    classDef domaineventhandler fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,font-weight:bold;
    classDef integrationevent fill:#fce4ec,stroke:#880e4f,stroke-width:2px;
    classDef integrationeventhandler fill:#fce4ec,stroke:#ad1457,stroke-width:2px,font-weight:bold;
    classDef integrationeventconverter fill:#e3f2fd,stroke:#0277bd,stroke-width:2px;
    classDef repo fill:#d6dbdf,stroke:#85929e,stroke-width:2px;
    classDef uow fill:#f2f4f4,stroke:#7f8c8d,stroke-width:2px;
